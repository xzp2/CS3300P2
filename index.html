<html>
<head>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Amatic+SC' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Josefin+Slab' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
<style>
html{
  overflow:hidden;
}
body{
  background: #333;
}
h1 {
  color: #85ce18;
  font: 60px 'Amatic SC';
  /*text-transform: uppercase;*/
  font-weight:bold;
  text-align: center;
  margin-top:-10px;
}
h2 {
  text-align:center;
  color: #cef424;
  margin-top:-35px;
  text-transform: uppercase;
  font: 20px 'Josefin Slab';
  font-weight:bold;
}
h3 {
  font:13px 'Varela Round';
  font-weight:bold;
  margin:0px;
  padding:0px;
}
input{
  font: 13px 'Varela Round';
  border-radius:20px;
  float:right;
  margin-right: 50px;
  background-color: #eeeeee;
  border: none;
  color: black;
  width:350px;
  height:50px;
  padding: 15px 32px;
  text-align: center;
  display: inline-block;
  -webkit-transition-duration: 0.4s;
    transition-duration: 0.4s;
}
form{
  padding-top: 40px;
}
.background {
  fill: #333;
}
.buttons{
  margin-left: 1000px;
  margin-top:80px;
}
#states {
  fill: #eee;
}
#state-borders {
  fill: none;
  stroke: #aaa;
  stroke-width: 1.5px;
}
.state:hover{
  fill: #111;
}
#svgMap{
  float:left;
}
.container{
  margin-top:-70px;
}
.one:hover{
  background-color: #ff0000; 
  color: white;
}
.two:hover{
  background-color: #551a8b; 
  color: white;
}
.three:hover{
  background-color: #5E2612; 
  color: white;
}
.four:hover{
  background-color: #0000ff; 
  color: white;
}
.five:hover{
  background-color: #2E8B57; 
  color: white;
}
.six:hover{
  background-color: #8B008B; 
  color: white;
}
.seven:hover{
  background-color: #9C661F; 
  color: white;
}
.eight:hover{
  background-color: #8E8E38; 
  color: white;
}
div.tooltip {
  position: absolute;
  text-align: center;
  width: 60px;
  height: 12px;
  padding: 8px;
  margin-top: 30px;
  margin-left:30px;
  font: 20px 'Varela Round';
  margin-top: -20px;
  font: 10px 'Open Sans';
  background: #ea9905;
  border-radius: 15px;
}

.axis {
  font: 10px sans-serif;
  color: white;
}

</style>
</head>
<body>
  <h1>The Bigfoot Phenomenon</h1>
  <h2>debunking popular myths or something</h2>
<div class="container">
  <div id="svgMap"></div>
  <div class="buttons">

    <div id="colorKey"></div>

    <form ><input class="one" type="button" value="Population" onclick="setMap('pop'); setScale('pop');"></input></form>

    <form ><input class="two" type="button" value="Average Temperature (F)" onclick="setMap('temp'); setScale('temp');"></input></form>

    <form ><input class="three" type="button" value="Mean Elevation (unit)" onclick="setMap('elev'); setScale('elev');"></input></form>

    <form ><input class="four" type="button" value="Average Rainfall (unit)" onclick="setMap('rain'); setScale('rain');"></input></form>

    <form ><input class="five" type="button" value="% Forest Cover" onclick="setMap('forest'); setScale('forest');"></input></form>

    <form ><input class="six" type="button" value="% Marijuana Users" onclick="setMap('drug'); setScale('drug');"></input></form>

    <form ><input class="seven" type="button" value="Alcohol Consumption (gallons per capita)" onclick="setMap('alcohol'); setScale('alcohol');"></input></form>

    <form ><input class="eight" type="button" value="% Urban Area" onclick="setMap('urban'); setScale('urban');"></input></form>
  </div>
</div>
<script>
var names;
var map;
var width = 900,
    height = 600,
    active = d3.select(null);
var projection = d3.geo.albersUsa()
    .scale(1070)
    .translate([width / 2, height / 2]);
var path = d3.geo.path()
    .projection(projection);
var svg = d3.select("#svgMap").append("svg")
    .attr("width", width)
    .attr("height", height);
svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height);
var g = svg.append("g");
var hover = d3.select("body").append('div')
            .attr('class', 'tooltip')
            .style('opacity', 0);
d3.json("us.json", function(error, us) {
  names = us;
  map = g.append("g")
  .attr("id", "states")
  .selectAll("path")
  .data(topojson.feature(us, us.objects.states).features)
  .enter().append("path")
  .attr("d", path)
  .attr("class", "state")
  .on("mousemove", function(d) {
    hover.style("opacity", .9);
    hover.classed('hidden', false)
    .style("left", (d3.event.pageX + 60) + "px"  )
    .style("top", (d3.event.pageY - 220) + "px")
    .style("height", "35%")
    .style("width", "13%")
    .html(
      "<h3>" + d.properties.stateName + "</h3> " + 
      "<br/><b>Number of Sightings:</b> " + d.properties.numSight + 
      "<br/><b>Most recent report:</b> " + d.properties.mostRecent + 
      "<br/> <br/> <u>Demographics</u><br/> <br/><b>Population:</b> " + d.properties.Pop + 
      "<br/><b>Avg. Annual Temp. (F):</b> " + d.properties.Temp + 
      "<br/><b>Avg. Elevation:</b> " + d.properties.Elev + 
      "<br/><b>Avg. Rainfall:</b> " + d.properties.Rain + 
      "<br/><b>Avg. Forest Cover:</b> " + d.properties.Forest + 
      "<br/><b>Drug Usage:</b> " + d.properties.Drug + 
      "<br/><b>Alcohol Usage:</b> " + d.properties.Alcohol + 
      "<br/><b>Percent Urban Area:</b> " + d.properties.urbArea+ "");  
    })
  .on("mouseout", function() {
    hover.attr("style", "opacity:0");
    });
  g.append("path")
      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);
});


var scale = d3.select("#colorKey").append("svg")
  .attr("width", 350)
  .attr("height", 30)
  .style("margin-left", "-15%")
  .style("margin-top", "20px")
  .style("background-color", "#eeeeee")
  .style("border-radius", "15px");

var gradient = scale.append("defs")
  .append("linearGradient")
    .attr("id", "gradient")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "0%");


function getColor(type, val){
  if(type=="pop"){
    var colorScale = d3.scale.linear().domain([400000, 40000000]).range(["#ffffff", "#ff0000"]);
    return colorScale(val);
  }
  else if(type=="temp"){
    var colorScale = d3.scale.linear().domain([25, 70]).range(["#0000ff", "#ff0000"]);
    return colorScale(val);
  }
  else if(type=="elev"){
    var colorScale = d3.scale.linear().domain([50, 7000]).range(["#F4A460", "#5E2612"]);
    return colorScale(val);
  }
  else if(type=="rain"){
    var colorScale = d3.scale.linear().domain([5, 65]).range(["#ffffff", "#0000ff"]);
    return colorScale(val);
  }
  else if(type=="forest"){
    var colorScale = d3.scale.linear().domain([10, 80]).range(["#ffffff", "#2E8B57"]);
    return colorScale(val);
  }
  else if(type=="drug"){
    var colorScale = d3.scale.linear().domain([35, 70]).range(["#ffffff", "#8B008B"]);
    return colorScale(val);
  }
  else if(type=="alcohol"){
    var colorScale = d3.scale.linear().domain([1, 4]).range(["#ffffff", "#9C661F"]);
    return colorScale(val);
  }
  else if(type=="urban"){
    var colorScale = d3.scale.log().domain([.01, 40]).range(["#ffffff", "#8E8E38"]);
    return colorScale(Math.log(val));
  }
}
function setMap(type){
  
  d3.json("us.json", function(error, us) {
    map.style("-webkit-transition-duration", "1s").style("transition-duration", "1s;")
    .style("fill",function(d){
    if(type=='pop') {return getColor(type,d.properties.Pop);}
    else if(type=='temp'){return getColor(type,d.properties.Temp);}
    else if(type=='elev'){return getColor(type,d.properties.Elev);}
    else if(type=='rain'){return getColor(type,d.properties.Rain);}
    else if(type=='forest'){return getColor(type,d.properties.Forest);}
    else if(type=='drug'){return getColor(type,d.properties.Drug);}
    else if(type=='alcohol'){return getColor(type,d.properties.Alcohol);}
    else if(type=='urban'){return getColor(type,d.properties.urbArea);}
    else{return "#eee";}
  });
  });
}

function setScale(type) {
  if(type=='pop') {
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#ffffff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#ff0000");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='temp'){
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#0000ff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#ff0000");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='elev'){
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#F4A460");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#5E2612");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='rain'){
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#ffffff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#0000ff");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='forest'){
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#ffffff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#2E8B57");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='drug'){
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#ffffff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#8B008B");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='alcohol'){
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#ffffff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#9C661F");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
  else if(type=='urban') {
    gradient.selectAll("stop").remove();
    gradient.append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#ffffff");
    gradient.append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#8E8E38");
    scale.append("rect")
      .attr("width", 350)
      .attr("height", 30)
      .style("fill", "url(#gradient)");
  }
}
</script>
</body>
</html>